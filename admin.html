<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>إدارة الفئات والعناصر</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f9f9f9; direction: rtl; }
    h2 { color: #333; }
    form { background: #fff; padding: 15px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 0 10px #ddd; }
    input, textarea, button, select { display: block; width: 100%; margin: 10px 0; padding: 10px; font-size: 1rem; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background: #218838; }
  </style>
</head>
<body>
  <h2>إضافة فئة (Category)</h2>
  <form id="categoryForm">
    <input type="text" name="name" placeholder="اسم الفئة" required />
    <select name="addel" id="addelSelect" required>
      <option value="">-- اختر آديل --</option>
    </select>
    <input type="file" name="image" accept="image/*" required />
    <button type="submit">حفظ الفئة</button>
  </form>

  <h2>إضافة عنصر (Item)</h2>
  <form id="itemForm">
    <input type="text" name="name" placeholder="اسم العنصر" required />
    <textarea name="description" placeholder="الوصف"></textarea>
    <input type="number" name="price" placeholder="السعر (€)" step="0.01" required />
    <select name="category" id="categorySelect" required>
      <option value="">-- اختر الفئة --</option>
    </select>
    <label>
      <input type="checkbox" name="isPopular" /> عنصر شائع
    </label>
    <input type="file" name="image" accept="image/*" required />
    <button type="submit">حفظ العنصر</button>
  </form>

  <script>
    const backendBaseUrl = 'https://restaurant-app-backend-s5yi.onrender.com/api';

    // إرسال الفئة
    document.getElementById('categoryForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      try {
        const res = await fetch(`${backendBaseUrl}/categories`, {
          method: 'POST',
          body: formData
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.message || 'فشل في حفظ الفئة');
        }

        const data = await res.json();
        console.log('Category added:', data);
        alert('✅ تم حفظ الفئة بنجاح!');
        form.reset();
        loadCategories(); // لتحديث قائمة الفئات بعد الإضافة
      } catch (err) {
        console.error(err);
        alert('❌ ' + err.message);
      }
    });

    // إرسال العنصر
    document.getElementById('itemForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      if (!formData.get('isPopular')) formData.set('isPopular', 'false');

      try {
        const res = await fetch(`${backendBaseUrl}/items`, {
          method: 'POST',
          body: formData
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.message || 'فشل في حفظ العنصر');
        }

        const data = await res.json();
        console.log('Item added:', data);
        alert('✅ تم حفظ العنصر بنجاح!');
        form.reset();
      } catch (err) {
        console.error(err);
        alert('❌ ' + err.message);
      }
    });

    // تحميل الفئات داخل select
    async function loadCategories() {
      try {
        const res = await fetch(`${backendBaseUrl}/categories`);
        if (!res.ok) throw new Error('لم يتم تحميل الفئات');
        const categories = await res.json();

        const categorySelect = document.getElementById('categorySelect');
        categorySelect.innerHTML = '<option value="">-- اختر الفئة --</option>'; // إعادة التهيئة

        categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat._id;
          option.textContent = cat.name;
          categorySelect.appendChild(option);
        });
      } catch (err) {
        console.error(err);
        alert('❌ حدث خطأ أثناء تحميل الفئات من السيرفر.');
      }
    }

    // تحميل الآديلات داخل select
    async function loadAddels() {
      try {
        const res = await fetch(`${backendBaseUrl}/addels`);
        if (!res.ok) throw new Error('لم يتم تحميل بيانات الآديل');
        const addels = await res.json();

        const addelSelect = document.getElementById('addelSelect');
        addelSelect.innerHTML = '<option value="">-- اختر آديل --</option>'; // إعادة التهيئة

        addels.forEach(addel => {
          const option = document.createElement('option');
          option.value = addel._id;
          option.textContent = addel.name;
          addelSelect.appendChild(option);
        });
      } catch (err) {
        console.error(err);
        alert('❌ حدث خطأ أثناء تحميل بيانات الآديل.');
      }
    }

    // عند تحميل الصفحة
    window.addEventListener('DOMContentLoaded', () => {
      loadAddels();
      loadCategories();
    });
  </script>
</body>
</html>
