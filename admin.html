<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>إدارة الفئات والعناصر</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f9f9f9; }
    h2 { color: #333; }
    form { background: #fff; padding: 15px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 0 10px #ddd; }
    input, textarea, button, select { display: block; width: 100%; margin: 10px 0; padding: 10px; font-size: 1rem; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background: #218838; }
  </style>
</head>
<body>
  <h2>إضافة فئة (Category)</h2>
  <form id="categoryForm">
    <input type="text" name="name" placeholder="اسم الفئة" required />
    <select name="addel" required>
        <option value="Bar">Bar</option>
        <option value="Kochen">Kochen</option>
    </select>
    <input type="file" name="image" accept="image/*" required />
    <button type="submit">حفظ الفئة</button>
  </form>

  <h2>إضافة عنصر (Item)</h2>
  <form id="itemForm">
    <input type="text" name="name" placeholder="اسم العنصر" required />
    <textarea name="description" placeholder="الوصف"></textarea>
    <input type="number" name="price" placeholder="السعر (€)" step="0.01" required />
    <select name="category" id="categorySelect" required>
      <option value="">-- اختر الفئة --</option>
    </select>
    
    <label>
      <input type="checkbox" name="isPopular" /> عنصر شائع
    </label>
    <input type="file" name="image" accept="image/*" required />
    <button type="submit">حفظ العنصر</button>
  </form>

  <script>
   
    const backendBaseUrl = 'https://restaurant-app-backend-s5yi.onrender.com/api'; // عدّله حسب رابطك الفعلي

    // معالجة إضافة الفئة
    document.getElementById('categoryForm').addEventListener('submit', async (e) => {
   e.preventDefault();
   const formData = new FormData(e.target);
   const addelText = formData.get('addel');

   // استبدل هذا النص بالقيمة الصحيحة لـ ObjectId
   let addel;
   if (addelText === 'Bar') {
     addel = '6817920deccb432b3f065efc'; // استبدل بهذا ObjectId الفعلي لـ Bar
   } else if (addelText === 'Kochen') {
     addel = '6817920deccb432b3f065f01'; // استبدل بهذا ObjectId الفعلي لـ Kochen
   } else {
     alert('معرف الآديل غير صالح');
     return;
   }

   formData.set('addel', addel); // استخدام الـ ObjectId الفعلي هنا

   const res = await fetch(`${backendBaseUrl}/categories`, {
     method: 'POST',
     body: formData
   });
   const data = await res.json();
   console.log('Category added:', data);
   alert('تم حفظ الفئة بنجاح!');
});


    // معالجة إضافة العنصر
    document.getElementById('itemForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      if (!formData.get('isPopular')) formData.set('isPopular', 'false');
      const res = await fetch(`${backendBaseUrl}/items`, {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      console.log('Item added:', data);
      alert('تم حفظ العنصر بنجاح!');
    });

    // تحميل الفئات تلقائيًا في select
 // تحميل الفئات من قاعدة البيانات وعرضها في الـ <select>
  async function loadCategories() {
    try {
      const res = await fetch(`${backendBaseUrl}/categories`);
      const categories = await res.json();

      const categorySelect = document.getElementById('categorySelect');
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat._id;
        option.textContent = cat.name;
        categorySelect.appendChild(option);
      });
    } catch (err) {
      console.error('فشل في تحميل الفئات:', err);
      alert('حدث خطأ أثناء تحميل الفئات من السيرفر.');
    }
  }

  // تحميل الفئات عند فتح الصفحة
  loadCategories();



  </script>
</body>
</html>
